# ディスクリプタ、ディスクリプタヒープについて
## ディスクリプタとは
 - GPUメモリ上に存在するリソースのこと
 - リソースは下記のように複数種類ある
   - テクスチャ
   - バッファ
   - シェーダーリソースビュー
   - 定数バッファビューなど
### ディスクリプタの種類
 - 上記のように異なるリソースの種類を設定できる
 - 例えばシェーダーリソースビューはテクスチャやバッファにアクセスするためのディスクリプタ
### ディスクリプタの作成と管理
 - ディスクリプタはディスクリプタヒープという領域で管理する
 - ディスクリプタヒープはCPUで設定し、GPUでアクセスする
![Alt text](ディスクリプタ.png)

## ディスクリプタヒープとは
 - GPU上で作られるディスクリプタを管理するための領域
 - データ転送
   - ディスクリプタヒープはCPUで設定し、GPUでアクセスするメカニズムを提供する
 - 動的なリソース管理
   - ディスクリプタヒープはプログラマーが必要な数のディスクリプタを動的に確保する機能がある
   - これで動的なリソース管理、レンダリング中にディスクリプタの数を変更したりできる
### ディスクリプタヒープでの効率的なリソース管理
 - ディスクリプタヒープの分割
   - 異なる種類のディスクリプタをそれぞれ異なるディスクリプタヒープで管理することが推奨される
   - プログラムでディスクリプタをアクセスする際に効率的になり、リソースの切り替えが効率よく行える
 - 静的、動的なディスクリプタアロケーション
   - 変更が少ないディスクリプタと変更が多いディスクリプタを分けておく
   - そうすることでディスクリプタの更新を効率よく行える
 - バッチ処理
   - 連続するディスクリプタの割り当てや変更はバッチ処理にまとめて行うことでオーバーヘッドを減らせる
 - メモリアライメント
   - ディスクリプタヒープのメモリアライメントを最適化することでメモリアクセスはさらに向上する
 - ディスクリプタの再利用
   - リソースが不要になった場合はディスクリプタは解放すべき
   - 解放されたディスクリプタは再利用可能なように保持しておくとメモリの無駄を減少させれる
![Alt text](ディスクリプタヒープ.png)

## ディスクリプタヒープ作成
```
	m_device->CreateDescriptorHeap(&desc, IID_PPV_ARGS(heap.ReleaseAndGetAddressOf()));
```
 - 第1引数：`D3D12_DESCRIPTOR_HEAP_DESC`構造体へのポインタ
   - ディスクリプタヒープの設定を渡している
 - 第2引数：各インタフェースの固有GUID
 - 第3引数：`ID3D12DescriptorHeap`インタフェースのポインタを格納する変数のアドレス
### `IID_PPV_ARGS`
 - GUIDやインタフェースを格納した変数のアドレスを簡易的に指定するマクロ

### `D3D12_DESCRIPTOR_HEAP_DESC`構造体
```
	D3D12_DESCRIPTOR_HEAP_DESC heapDesc = {};
	heapDesc.Type = D3D12_DESCRIPTOR_HEAP_TYPE_RTV;
	heapDesc.NodeMask = 0;
	heapDesc.NumDescriptors = 1;
	heapDesc.Flags = D3D12_DESCRIPTOR_HEAP_FLAG_NONE;
```
 - Type：デスクリプタヒープのタイプを設定。
   - CBV：配列などの定数データ
   - SRV：テクスチャ、フレームバッファ、モデルなどのリソースデータ
   - UAV：SRVと同じだがシェーダーから直接書き込みが行える
   - SAMPLER：テクスチャ読み込みのパラメータ用
   - RTV：レンダーターゲット用（描画するフレームバッファ）
   - DSV：深度やステンシルマスクの描画先に指定
 - NodeMask：複数のGPUを利用する場合の識別用フラグに使用
   - GPUが1つしかない場合は0を指定
 - NumDescriptors：格納できるディスクリプタの数を指定
 - Flags：ディスクリプタが参照しているデータの見え方
   - `D3D12_DESCRIPTOR_HEAP_FLAG_SHADER_NONE`：シェーダーからは見えない
   - `D3D12_DESCRIPTOR_HEAP_FLAG_SHADER_VISIBLE`：シェーダーから参照できる


